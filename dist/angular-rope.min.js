/**
 * Angular Promise Chaining Service
 * @version v0.2.4 - 2013-12-30
 * @link https://github.com/platanus/angular-rope
 * @author Ignacio Baixas <ignacio@platan.us>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(a){"use strict";var b={};a.module("platanus.rope",[]).factory("rope",["$q","$timeout",function(c,d){function e(a){return a&&"function"==typeof a.then?a:{then:function(b){if(!b)return this;try{return e(b(a))}catch(c){return f(c)}},"finally":function(a){try{var b=a();return"undefined"==typeof b?this:b}catch(c){return f(c)}}}}function f(a){return{then:function(b,c){if(!c)return this;try{return e(c(a))}catch(d){return f(d)}},"finally":function(a){try{return a(),this}catch(b){return f(b)}}}}function g(a,b,d,e){for(var f,g,h,i=b;"function"==typeof i;)try{f=l,l={chains:[],context:a,data:d,error:e},i=i.call(a,d)}finally{if(g=l.chains.length,1===g)i=l.chains[0].promise;else if(g>1){for(i=[],h=0;g>h;h++)i.push(l.chains[h].promise);i=c.all(i)}l=f}return"undefined"!=typeof i||e?i:d}function h(a){return a||(l?l.context:null)}function i(a){this.value=a}function j(a){return a&&a instanceof i?a.value:a}function k(a){this.promise=a,l&&l.chains.push(this)}var l=null;k.prototype={$$skip:function(){return this.$$exit||this.$$ctxBlk&&this.$$ctxBlk.length>0&&!this.$$ctxBlk[this.$$ctxBlk.length-1]},seed:function(a,b){return this.next(new i(a),b)},next:function(a,b){var c=this,d=h(b);return this.promise=this.promise.then(function(b){return c.$$skip()?b:g(d,a,j(b),!1)}),this},handle:function(a,b){var c=this,d=h(b);return this.promise=this.promise.then(null,function(b){return c.$$skip()?f(b):g(d,a,b,!0)}),this},always:function(a,b){return this.next(function(){return"function"==typeof a?a.apply(this):a},b).handle(function(b){return e("function"==typeof a?a.apply(this):a).then(function(){return f(b)},function(){return f(b)})},b),this},nextIf:function(a,c){var d=this;return this.promise=this.promise.then(function(f){if(d.$$skip())d.$$ctxBlk.push(!1);else{if(d.$$ctxBlk||(d.$$ctxBlk=[]),"undefined"!=typeof a)return e(g(c,a,j(f),!1)).then(function(a){return d.$$ctxBlk.push(a===b?null:!!a),f});d.$$ctxBlk.push(!!f)}return f}).then(null,function(a){return d.$$ctxBlk.push(!1),f(a)}),this},orNextIf:function(a,c){var d,e=this;return this.promise=this.promise["finally"](function(){d=e.$$ctxBlk.pop()}),this.nextIf(function(){return d===!1?a:b},c)},orNext:function(){return this.orNextIf(!0)},nextCase:function(a){return this.nextIf(function(b){return a==b})},orNextCase:function(a){return this.orNextIf(function(b){return a==b})},end:function(){var a=this;return this.promise=this.promise["finally"](function(){a.$$ctxBlk.pop()}),this},exit:function(){var a=this;return this.next(function(){a.$$exit=!0})},wait:function(a){return this.promise=this.promise.then(function(b){var e=c.defer();return d(function(){e.resolve(b)},a),e.promise}),this},apply:function(a,b){return this.next(function(c){return c[a].apply(c,b)})},call:function(a){var b=Array.prototype.slice.call(arguments,1);return this.apply(a,b)},forkEach:function(b,c){return this.next(function(d){a.forEach(d,function(a){new k(e(a)).next(b,c)})})}};var m={confer:e,reject:f,task:function(a){return function(){var b=arguments,c=this;return function(d){m.seed(d).next(function(){return a.apply(this,b)},c)}}},inherit:function(){return new k(l.error?f(l.data):e(l.data))},seed:function(a){return new k(e(new i(a)))},next:function(a,b){return new k(e(null)).next(a,b)},nextIf:function(a,b){return new k(e(null)).nextIf(a,b)}};return m}])}(angular);