/**
 * Angular Promise Chaining Service
 * @version v0.2.2 - 2013-12-26
 * @link https://github.com/platanus/angular-rope
 * @author Ignacio Baixas <ignacio@platan.us>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(a){"use strict";a.module("platanus.rope",[]).factory("rope",["$q","$timeout",function(b,c){function d(a){return a&&"function"==typeof a.then?a:a&&a.$promise?a.$promise:{then:function(b){if(!b)return this;try{var c=b(a);return"undefined"!=typeof c?d(c):this}catch(f){return e(f)}},"finally":function(a){try{var b=a();return"undefined"!=typeof b?d(b):this}catch(c){return e(c)}}}}function e(a){return{then:function(b,c){if(!c)return this;try{var f=c(a);return"undefined"!=typeof f?d(f):this}catch(g){return e(g)}},"finally":function(a){try{var b=a();return"undefined"!=typeof b?e(b):this}catch(c){return e(c)}}}}function f(a,c,d,e){for(var f,g,h,i=c;"function"==typeof i;)try{f=k,k={chains:[],context:a,data:d,error:e},i=i.call(a,d)}finally{if(g=k.chains.length,1===g)i=k.chains[0].promise;else if(g>1){for(i=[],h=0;g>h;h++)i.push(k.chains[h].promise);i=b.all(i)}k=f}return i}function g(a){return a||(k?k.context:null)}function h(a){this.value=a}function i(a){return a&&a instanceof h?a.value:a}function j(a){this.promise=a,k&&k.chains.push(this)}var k=null;j.prototype={$$skip:function(){return this.$$cstack&&this.$$cstack.length>0&&!this.$$cstack[this.$$cstack.length-1]},seed:function(a,b){return this.next(new h(a),b)},next:function(a,b){var c=this,d=g(b);return this.promise=this.promise.then(function(b){return c.$$skip()?void 0:f(d,a,i(b),!1)}),this},handle:function(a,b){var c=this,e=g(b);return this.promise=this.promise.then(null,function(b){return c.$$skip()?void 0:d(f(e,a,b,!0))}),this},always:function(a,b){return this.next(function(){return"function"==typeof a?a.apply(this):a},b).handle(function(b){return d("function"==typeof a?a.apply(this):a).then(function(){return e(b)},function(){return e(b)})},b),this},nextIf:function(a,b){var c=this;return this.promise=this.promise.then(function(e){return c.$$cstack||(c.$$cstack=[]),"undefined"!=typeof a?d(f(b,a,i(e),!0)).then(function(a){return c.$$cstack.push(!!a),e}):(c.$$cstack.push(e),void 0)}).then(null,function(a){return c.$$cstack.push(!1),e(a)}),this},orNextIf:function(a,b){var c=this;return this.promise=this.promise.then(function(e){var g=c.$$cstack[c.$$cstack.length-1];return g===!1?d(f(b,a,i(e),!0)).then(function(a){return c.$$cstack.pop(),c.$$cstack.push(!!a),e}):(g&&(c.$$cstack.pop(),c.$$cstack.push(null)),void 0)}).then(null,function(a){return c.$$cstack.pop(),c.$$cstack.push(!1),e(a)}),this},orNext:function(){return this.orNextIf(!0)},nextCase:function(a){return this.nextIf(function(b){return a===b})},orNextCase:function(a){return this.orNextIf(function(b){return a===b})},end:function(){var a=this;return this.promise=this.promise["finally"](function(){a.$$cstack.pop()}),this},wait:function(a){return this.promise=this.promise.then(function(d){var e=b.defer();return c(function(){e.resolve(d)},a),e.promise}),this},apply:function(a,b){return this.next(function(c){return c[a].apply(c,b)})},call:function(a){var b=Array.prototype.slice.call(arguments,1);return this.apply(a,b)},forkEach:function(b,c){return this.next(function(e){a.forEach(e,function(a){new j(d(a)).next(b,c)})})}};var l={confer:d,reject:e,task:function(a){return function(){var b=arguments,c=this;return function(d){l.seed(d).next(function(){return a.apply(this,b)},c)}}},inherit:function(){return new j(k.error?e(k.data):d(k.data))},seed:function(a){return new j(d(new h(a)))},next:function(a,b){return new j(d(null)).next(a,b)},nextIf:function(a,b){return new j(d(null)).nextIf(a,b)}};return l}])}(angular);