/**
 * Angular Promise Chaining Service
 * @version v0.2.1 - 2013-12-24
 * @link https://github.com/platanus/angular-rope
 * @author Ignacio Baixas <ignacio@platan.us>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(a){"use strict";a.module("platanus.rope",[]).factory("rope",["$q",function(b){function c(a){return a&&"function"==typeof a.then?a:a&&a.$promise?a.$promise:{then:function(b){if(!b)return this;try{var e=b(a);return"undefined"!=typeof e?c(e):this}catch(f){return d(f)}},"finally":function(a){try{var b=a();return"undefined"!=typeof b?c(b):this}catch(e){return d(e)}}}}function d(a){return{then:function(b,e){if(!e)return this;try{var f=e(a);return"undefined"!=typeof f?c(f):this}catch(g){return d(g)}},"finally":function(a){try{var b=a();return"undefined"!=typeof b?d(b):this}catch(c){return d(c)}}}}function e(a,c,d,e){var f,g,h,i;if("function"==typeof c){try{f=j,j={chains:[],context:a,data:d,error:e},g=c.call(a,d)}finally{if(h=j.chains.length,1===h)g=j.chains[0].promise;else if(h>1){for(g=[],i=0;h>i;i++)g.push(j.chains[i].promise);g=b.all(g)}j=f}return g}return c}function f(a){return a||(j?j.context:null)}function g(a){this.value=a}function h(a){return a&&a instanceof g?a.value:a}function i(a){this.promise=a,j&&j.chains.push(this)}var j=null;return i.prototype={$$skip:function(){return this.$$cstack&&this.$$cstack.length>0&&!this.$$cstack[this.$$cstack.length-1]},seed:function(a,b){return this.next(new g(a),b)},next:function(a,b){var c=this,d=f(b);return this.promise=this.promise.then(function(b){return c.$$skip()?void 0:e(d,a,h(b),!1)}),this},handle:function(a,b){var d=this,g=f(b);return this.promise=this.promise.then(null,function(b){return d.$$skip()?void 0:c(e(g,a,b,!0))}),this},always:function(a,b){return this.next(function(){return"function"==typeof a?a.apply(this):a},b).handle(function(b){return c("function"==typeof a?a.apply(this):a).then(function(){return d(b)},function(){return d(b)})},b),this},nextIf:function(a,b){var f=this;return this.promise=this.promise.then(function(d){return f.$$cstack||(f.$$cstack=[]),"undefined"!=typeof a?c(e(b,a,h(d),!0)).then(function(a){return f.$$cstack.push(!!a),d}):(f.$$cstack.push(d),void 0)}).then(null,function(a){return f.$$cstack.push(!1),d(a)}),this},orNextIf:function(a,b){var f=this;return this.promise=this.promise.then(function(d){var g=f.$$cstack[f.$$cstack.length-1];return g===!1?c(e(b,a,h(d),!0)).then(function(a){return f.$$cstack.pop(),f.$$cstack.push(!!a),d}):(g&&(f.$$cstack.pop(),f.$$cstack.push(null)),void 0)}).then(null,function(a){return f.$$cstack.pop(),f.$$cstack.push(!1),d(a)}),this},orNext:function(){return this.orNextIf(!0)},nextCase:function(a){return this.nextIf(function(b){return a===b})},orNextCase:function(a){return this.orNextIf(function(b){return a===b})},end:function(){var a=this;return this.promise=this.promise["finally"](function(){a.$$cstack.pop()}),this},forkEach:function(b,d){this.next(function(e){a.forEach(e,function(a){new i(c(a)).next(b,d)})})}},{confer:c,reject:d,task:function(a){return function(){var b=arguments,c=this;return function(d){var e=a.apply(c,b);return"function"==typeof e?e.call(c,h(d)):e}}},inherit:function(){return new i(j.error?d(j.data):c(j.data))},seed:function(a){return new i(c(new g(a)))},next:function(a,b){return new i(c(null)).next(a,b)},nextIf:function(a,b){return new i(c(null)).nextIf(a,b)}}}])}(angular);